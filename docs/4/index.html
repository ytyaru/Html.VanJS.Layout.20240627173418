<style>
:root {
    --font-size:max(16px, calc(100vw / 42));
    --em-style:filled sesame;
    --em-color:#fff;
    --color:#fff;
    --a-color:#ff0;
    --background-color:#000;
    --selection-color:#000;
    --selection-background-color:#aa0;
    --a-selection-color:#ee0;
    --a-selection-background-color:#00f;
    --caret-color: auto;
    --outline-color:#fff;
    --outline-style:solid;
    --outline-width:2px;
    --button-focus-color:#000;
    --button-focus-background-color:#aa0;
}
body {
    overflow-x:hidden;
    overflow-y:hidden;
    padding:0;margin:0;
    width:100%;
    height:100%;
}
*:focus {
    outline-color: var(--outline-color);
    outline-style: var(--outline-style);
    outline-width: var(--outline-width);
}
button:focus {
    color: var(--button-focus-color);
    background-color: var(--button-focus-background-color);
}
body, textarea, button {
    font-family: 'Noto Serif JP', 'Source Han Serif JP', 'Noto Color Emoji', serif; 
    font-size: var(--font-size);
    line-height: 1.7em;
    letter-spacing: 0.05em;
    color: var(--color);
    background-color: var(--background-color);
    caret-color: var(--caret-color);
}
::selection {
    color: var(--selection-color);
    background-color: var(--selection-background-color);
    text-shadow: none;
}
a::selection {
    color: var(--a-selection-color);
    background-color: var(--a-selection-background-color);
    text-shadow: none;
}
button { user-select:none; font-size:var(--font-size); padding:0; margin:0; line-height:1em; letter-spacing:0; word-break:break-word; }
h1 { font-family: 'Noto Sans JP', 'Source Han Sans JP', 'Noto Color Emoji', sans-serif; }
em {
    font-style: normal; /* 非イタリック化 */
    text-emphasis: var(--em-style) var(--em-color);
    -webkit-text-emphasis: var(--em-style) var(--em-color);
}
a:link, a:visited, a:hover, a:active { color: var(--a-color); }
/*
a:link { color: #0000ff; }
a:visited { color: #000080; }
a:hover { color: #ff0000; }
a:active { color: #ff8000; }
*/
</style>
<script type="text/javascript" src="../lib/van/1.5.0/nomodule.min.js"></script>
<script type="text/javascript" src="../lib/util/string/length.js"></script>
<!--<script type="text/javascript" src="layout.js"></script>-->
<script type="text/javascript" src="fit-div.js"></script>
<script>
window.addEventListener('DOMContentLoaded', async(event) => {
    const htmls = van.state([])
    const children = [
        //()=>van.tags.button({onclick:()=>fitDiv.children.val=[...htmls.val, van.tags.p('あ')]}, '＋'),
        ()=>van.tags.button({onclick:()=>{fitDiv.children.val=[...fitDiv.children.val, van.tags.p('あ')];console.log(fitDiv.children)}}, '＋'),
        ()=>van.tags.button({onclick:()=>fitDiv.children.val=[]}, '×'),
//        ()=>van.tags.button({onclick:()=>htmls.val=[...htmls.val, van.tags.p('あ')]}, '＋'),
//        ()=>van.tags.button({onclick:()=>htmls.val=[]}, '×'),
//        ()=>`W:${fitDiv.size.w.val}`, 
//        ()=>`H:${fitDiv.size.h.val}`, 
        ...htmls.val,
//        htmls,
    ]
    const fitDiv = new FitDiv(children)
    /*
    fitDiv.children.val = [
        ()=>van.tags.button({onclick:()=>htmls.val=[...htmls.val, van.tags.p('あ')]}, '＋'),
        ()=>van.tags.button({onclick:()=>htmls.val=[]}, '×'),
        ()=>`W:${fitDiv.size.w.val}`, 
        ()=>`H:${fitDiv.size.h.val}`, 
        ...htmls.val,
    ]
    */
    //van.add(document.body, ()=>fitDiv.el)
    van.add(document.body, fitDiv.el)
    window.addEventListener('resize', async(e)=>fitDiv.resize())
    /*
    class DocState {
        constructor() {
            this._size = {
                w: van.state(document.body.clientWidth),
                h: van.state(document.documentElement.clientHeight),
            }
        }
        get Size() { return this._size }
        resize() {
            this._size.w.val = document.body.clientWidth
            this._size.h.val = document.documentElement.clientHeight
            console.log(this._size.w.val, this._size.h.val)
        }
    }
    const state = new DocState()
    const htmls = van.state([])
    van.add(document.body,
        ()=>van.tags.div({style:()=>`box-sizing:border-box;width:${state.Size.w.val};height:${state.Size.h.val};padding:0;margin:0;overflow-y:auto;`}, 
            ()=>van.tags.button({onclick:()=>htmls.val=[...htmls.val, van.tags.p('あ')]}, '＋'),
            ()=>van.tags.button({onclick:()=>htmls.val=[]}, '×'),
            ()=>`W:${state.Size.w.val}`, 
            ()=>`H:${state.Size.h.val}`, 
            //htmls,
            ...htmls.val,
            //()=>'あ'.repeat(2).Graphemes.map(v=>van.tags.p(v)), 
            //...()=>'あ'.repeat(2).Graphemes.map(v=>van.tags.p(v)), 
            //'い'.repeat(5).Graphemes.map(v=>van.tags.p(v))),
        )
    )
//    function getEls() { return 'あ'.repeat(2).Graphemes.map(v=>van.tags.p(v)) }
    window.addEventListener('resize', async(e)=>state.resize())
    */
})
</script>
